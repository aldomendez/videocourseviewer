<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>PIX: English Courses</title>
  <link rel="stylesheet" href="shoelace.css">
  <style>
    .prose {
      display: grid;
      grid-template-columns: [full-start] minmax(1em, 1fr) [main-start] minmax(0, 40em) [main-end] minmax(1em, 1fr) [full-end];
    }

    .prose>* {
      grid-column: main;
    }

    .prose-splash {
      grid-column: full;
    }
  </style>
</head>

<body>
  <div class="prose">
    <video id="video-lesson" src="converted-videos/5Where-is-it-1.m4v" height="300" width="400" loop controls></video>
  </div>
  <div class="prose">
    <ol id="dialogs"></ol>
  </div>
</body>
<script src="cell.js"></script>
<script>

  var list = {
    $cell: true,
    $type: 'ul',
    _skips: [],
    _currentSkip:0,
    id:'dialogs',
    $components: [{
      $type: 'li',
      $text: ' videos[0]'
    }],
    $update: function () {
      this.$components = this._skips.map(function (el, i) {
        return {
          $type: 'li',
          $components: [{
            $type:'a',
            href:'#',
            class:'button button-sm',
            $text:'> ',
            onclick(){
              console.log(el.start)
              var vd = document.getElementById('video-lesson')
              vd.currentTime = el.start
              vd.play()
              vd.ontimeupdate = function (e) {
                if (vd.currentTime > el.end) {
                  vd.pause()
                }
              };
            }
          },{
            $type: 'a',
            href: '#',
            $text: '  ' + el.text
          }]
        }
      })
    },
    _setSkips(data){
      console.log(data)
      this._skips = data
    },
    $init:function(){
      var v = document.getElementById('video-lesson')
      v.ontimeupdate = function (e) {
        console.log('currentTime:' + v.currentTime)
      };
      var videos = ['5Where-it-is.mp4']
    
      dialogTest = `1. [Where is it](0-3)
    2. [I hope this will helps](3.2-4.8)
    3. [welcome to our course](4.8-5.6)
    `
    
      var comps = dialogTest.trim().split('\n').map(function (el, i) {
        if (el === "") { return '' }
        var r = /\d+\..\[(.*)]\((\S*)\)/
        var rescued = r.exec(el)
        console.log(JSON.stringify(rescued))
        return rescued.reduce(function prepareElements(pre, curr, i) {
          if (i == 0) { return {} }
          if (i == 1) { pre.text = curr }
          if (i == 2) {
            pre.start = curr.split('-')[0]
            pre.end = curr.split('-')[1]
          }
          return pre
        }, {})
      })
      console.log(comps)
      document.getElementById('dialogs')._setSkips(comps)
    }
  }
</script>
<script src="courseplay.js"></script>

</html>