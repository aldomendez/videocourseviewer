<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>PIX: English Courses</title>
  <link rel="stylesheet" href="shoelace.css">
  <style>
    .prose {
      display: grid;
      grid-template-columns: [full-start] minmax(1em, 1fr) [main-start] minmax(0, 40em) [main-end] minmax(1em, 1fr) [full-end];
    }

    .prose>* {
      grid-column: main;
    }

    .prose-splash {
      grid-column: full;
    }
  </style>
</head>

<body>
  <div class="prose">
    <video id="video-lesson" src="converted-videos/5Where-is-it-1.m4v" height="300" width="400" loop controls></video>
  </div>
  <div class="prose">
    <ol id="editor"></ol>
  </div>
  <div class="prose">
    <ol id="dialogs"></ol>
  </div>
</body>
<script src="cell.js"></script>
<script>

  var Editor = {
    id:'editor',
    $cell:true,
    $type:'form',
    _visible:true,
    _start:0,
    _finish:0,
    id:'editor',
    $components:[],
    $init(){
      var vd = document.getElementById('video-lesson')
      var editor = document.getElementById('editor')
      var that = this
      this.ontimeopdateListener = function ontimeopdateListener(event) {
        console.log('currentTime:' + vd.currentTime)
        editor._start = vd.currentTime
        editor.$update()
      }
      vd.addEventListener('timeupdate', this.ontimeopdateListener)
    },
    $update:function(){
      this.$components = [{
      $type:'div',
      class:'input-group',
      $components:[{
        $type:'button',
        type:'button',
        $text:this._start,
        class:'button'
      },{
        $type:'input',
        type:'text',
        value:this._starts
      },{
        $type:'button',
        type:'button',
        $text:this._end,
        class:'button'
      },]
    },{
      $type:'div',
      class:'input-group',
      $components:[{
        $type:'input',
        type:'range',
        value:'50'
      },{
        $type:'input',
        type:'range',
        value:'50'
      }]
    },{
      $type:'div',
      class:'input-group',
      $components:[{
        $type:'button',
        type:'button',
        class:'button',
        $text:'Add'
      }]
    }]
    }
  }

  var list = {
    $cell: true,
    $type: 'ul',
    _skips: [],
    _currentSkip:0,
    id:'dialogs',
    $components: [{
      $type: 'li',
      $text: ' videos[0]'
    }],
    $update: function () {
      this.$components = this._skips.map(function (el, i) {
        return {
          $type: 'li',
          $components: [{
            $type: 'a',
            href: '#',
            $text: '  ' + el.text,
            onclick(){
              console.log(el.start)
              var vd = document.getElementById('video-lesson')
              vd.currentTime = el.start
              vd.play()
              vd.ontimeupdate = function (e) {
                if (vd.currentTime >= el.end) {
                  vd.pause()
                }
              }
            }
          }]
        }
      })
    },
    _setSkips(data){
      // console.log(data)
      this._skips = data
    },
    $init:function(){
      this.ontimeopdateListener = function (e) {
        // console.log('currentTime:' + v.currentTime)
      }
      var v = document.getElementById('video-lesson')
      v.addEventListener('timeupdate', this.ontimeopdateListener);
      var videos = ['5Where-it-is.mp4']
    
      dialogTest = `
    1. [Where is it](15-20)
    2. [Hello, welcome back](20-23)
    3. [This is program 5 (five)](23-25)
    3. [5...5...5...5](25-30)
    `
    
      var comps = dialogTest.trim().split('\n').map(function (el, i) {
        if (el === "") { return '' }
        var r = /\d+\..\[(.*)]\((\S*)\)/
        var rescued = r.exec(el)
        // console.log(JSON.stringify(rescued))
        return rescued.reduce(function prepareElements(pre, curr, i) {
          if (i == 0) { return {} }
          if (i == 1) { pre.text = curr }
          if (i == 2) {
            pre.start = curr.split('-')[0]
            pre.end = curr.split('-')[1]
          }
          return pre
        }, {})
      })
      // console.log(comps)
      document.getElementById('dialogs')._setSkips(comps)
    }
  }
</script>
<script src="courseplay.js"></script>

</html>